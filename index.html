<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TON Farm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7VX72GI4L9RpVB212torJKhTdOEELDGk",
      authDomain: "ton-bon.firebaseapp.com",
      databaseURL: "https://ton-bon-default-rtdb.firebaseio.com",
      projectId: "ton-bon",
      storageBucket: "ton-bon.firebasestorage.app",
      messagingSenderId: "747409619156",
      appId: "1:747409619156:web:0ec4e018f8f674b7b02341",
      measurementId: "G-HY4KES5K2X"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    body {
      font-family: "Press Start 2P", monospace;
      background: #87ceeb;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .game-container {
      max-width: 420px;
      margin: 0 auto;
      background: #6ab04c;
      border: 8px solid #3b3b3b;
      image-rendering: pixelated;
      min-height: 100vh;
      box-shadow: 0 0 0 4px #000;
    }

    .pixel-btn {
      margin: 4px;
      padding: 8px 10px;
      font-size: 10px;
      border: 3px solid #000;
      background: #f1c40f;
      box-shadow: 3px 3px #000;
      cursor: pointer;
    }

    .pixel-btn:active {
      box-shadow: 0 0 #000;
      transform: translate(2px, 2px);
    }

    .tabs {
      display: flex;
      justify-content: space-around;
      margin: 6px;
    }

    .tab-btn {
      flex: 1;
      margin: 0 2px;
      padding: 6px 0;
      font-size: 9px;
      border: 3px solid #000;
      background: #bdc3c7;
      box-shadow: 2px 2px #000;
      cursor: pointer;
    }

    .tab-btn.active {
      background: #f1c40f;
    }

    .tab-content {
      background: #ecf0f1;
      margin: 6px;
      padding: 6px;
      border: 3px solid #000;
      font-size: 9px;
      text-align: left;
      min-height: 80px;
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    #notifyContainer {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 9999;
    }

    .notify {
      background: #f1c40f;
      border: 3px solid #000;
      padding: 8px;
      margin-top: 6px;
      font-size: 10px;
      width: 180px;
      box-shadow: 3px 3px #000;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head> 
<body>
  <div id="notifyContainer"></div>

  <div class="game-container">

    <div class="top-bar" style="background:#3b3b3b;color:#fff;padding:6px;font-size:10px;display:flex;justify-content:space-around;border-bottom:4px solid #000;">
      <div>TON: <span id="ton">0</span></div>
      <div>LVL: <span id="farmLevel">1</span></div>
      <div>XP: <span id="xp">0</span></div>
    </div>

    <h1 style="font-size:16px;margin:10px 0;color:#fff;text-shadow:2px 2px #000;">üêî PIXEL TON FARM</h1>

    <img src="https://i.imgur.com/4xvZp0P.png" class="chicken-img" style="width:96px;margin:8px auto;image-rendering:pixelated;">

    <div class="stat-box" style="background:#ecf0f1;margin:6px 10px;padding:6px;border:3px solid #000;font-size:10px;text-align:left;">
      <div><span class="label">–ö—É—Ä—ã</span><span class="value" id="chickens" style="float:right;">0</span></div>
      <div><span class="label">–Ø–π—Ü–∞</span><span class="value" id="eggs" style="float:right;">0</span></div>
      <div><span class="label">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</span><span class="value" style="float:right;"><span id="eggsPerHour">0</span>/h</span></div>
    </div>

    <div class="stat-box">
      <div><span class="label">–°–ª–µ–¥—É—é—â–µ–µ —è–π—Ü–æ</span><span class="value"><span id="timer">86</span> —Å–µ–∫</span></div>
      <div id="progressBar" style="width:90%;height:12px;background:#95a5a6;border:3px solid #000;margin:6px auto;">
        <div id="progressFill" style="height:100%;width:0%;background:#2ecc71;"></div>
      </div>
    </div>

    <div class="stat-box">
      <div><span class="label">–ò–Ω–∫—É–±–∞—Ç–æ—Ä</span><span class="value" id="incStatus">–û–∂–∏–¥–∞–Ω–∏–µ</span></div>
      <div id="incubatorBar" style="width:90%;height:12px;background:#95a5a6;border:3px solid #000;margin:6px auto;">
        <div id="incubatorFill" style="height:100%;width:0%;background:#e67e22;"></div>
      </div>
    </div>

    <button class="pixel-btn" onclick="buyChickens()">–ö—É–ø–∏—Ç—å –∫—É—Ä (1 TON = 3000)</button>
    <button class="pixel-btn" onclick="sellEggs()">–ü—Ä–æ–¥–∞—Ç—å —è–π—Ü–∞ (100 —è–∏—Ü = 0.1 TON)</button>
    <button class="pixel-btn" onclick="startIncubator()">üß™ –ò–Ω–∫—É–±–∞—Ç–æ—Ä (100 —è–∏—Ü ‚Üí 95 –∫—É—Ä)</button>

    <div class="level-label" style="font-size:10px;color:#fff;text-shadow:2px 2px #000;margin-top:4px;">
      –§–µ—Ä–º–∞: <span id="farmName">–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è —Ñ–µ—Ä–º–∞</span>
    </div>

    <div class="ref-box" style="background:#ecf0f1;margin:6px 10px;padding:6px;border:3px solid #000;font-size:9px;text-align:left;">
      <div><b>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞:</b> –ø—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ ‚Äî –≤—ã –æ–±–∞ –ø–æ–ª—É—á–∏—Ç–µ +100 —è–∏—Ü</div>
      <button class="pixel-btn" onclick="copyRef()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É</button>
      <div class="ref-link" id="refLinkText" style="font-size:8px;word-break:break-all;margin-top:4px;"></div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
      <button class="tab-btn active" id="tabUpgrades" onclick="switchTab('upgrades')">–£–ª—É—á—à–µ–Ω–∏—è</button>
      <button class="tab-btn" id="tabAchievements" onclick="switchTab('achievements')">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
      <button class="tab-btn" id="tabAuction" onclick="switchTab('auction')">–ê—É–∫—Ü–∏–æ–Ω</button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->

    <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
    <div class="tab-content" id="tabContentUpgrades">
      <div class="upgrade-item">
        <div class="upgrade-title">‚è± –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (5 TON)</div>
        <div class="upgrade-desc">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∏—Ü. –¢–µ–∫. —É—Ä–æ–≤–µ–Ω—å: <span id="speedLevelText">1</span></div>
        <button class="pixel-btn" onclick="upgradeSpeed()">–ö—É–ø–∏—Ç—å</button>
      </div>

      <div class="upgrade-item">
        <div class="upgrade-title">üí∞ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ (5 TON)</div>
        <div class="upgrade-desc">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ —Å –ø—Ä–æ–¥–∞–∂–∏ —è–∏—Ü. –¢–µ–∫. —É—Ä–æ–≤–µ–Ω—å: <span id="profitLevelText">1</span></div>
        <button class="pixel-btn" onclick="upgradeProfit()">–ö—É–ø–∏—Ç—å</button>
      </div>
    </div>

    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
    <div class="tab-content" id="tabContentAchievements" style="display:none;">
      <div class="achievement-item" id="ach1">
        <div class="upgrade-title">üê£ –ü–µ—Ä–≤—ã–π –≤—ã–≤–æ–¥–æ–∫</div>
        <div class="upgrade-desc">–ù–∞–∫–æ–ø–∏ 1000 —è–∏—Ü.</div>
      </div>
      <div class="achievement-item" id="ach2">
        <div class="upgrade-title">üêî –§–µ—Ä–º–µ—Ä‚Äë–Ω–æ–≤–∏—á–æ–∫</div>
        <div class="upgrade-desc">–ö—É–ø–∏ 3000 –∫—É—Ä.</div>
      </div>
      <div class="achievement-item" id="ach3">
        <div class="upgrade-title">üè° –ù–æ–≤–∞—è —Ñ–µ—Ä–º–∞</div>
        <div class="upgrade-desc">–î–æ—Å—Ç–∏–≥–Ω–∏ 3 —É—Ä–æ–≤–Ω—è —Ñ–µ—Ä–º—ã.</div>
      </div>
    </div>

    <!-- –ê—É–∫—Ü–∏–æ–Ω -->
    <div class="tab-content" id="tabContentAuction" style="display:none;">

      <button class="pixel-btn" onclick="openCreateAuction()">–°–æ–∑–¥–∞—Ç—å –ª–æ—Ç</button>

      <div id="auctionList" style="margin-top:10px;">
        –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–∫—Ü–∏–æ–Ω–æ–≤...
      </div>

      <!-- –û–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ—Ç–∞ -->
      <div id="createAuctionWindow" style="display:none;margin-top:10px;padding:6px;border:3px solid #000;background:#fff;">
        <div style="font-size:10px;margin-bottom:6px;">–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ—Ç–∞</div>

        <label style="font-size:9px;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–∏—Ü:</label>
        <input id="auctionEggs" type="number" min="100" style="width:90%;padding:4px;margin-bottom:6px;">

        <label style="font-size:9px;">–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ (TON):</label>
        <input id="auctionPrice" type="number" step="0.01" style="width:90%;padding:4px;margin-bottom:6px;">

        <button class="pixel-btn" onclick="createAuction()">–°–æ–∑–¥–∞—Ç—å</button>
        <button class="pixel-btn" onclick="closeCreateAuction()">–û—Ç–º–µ–Ω–∞</button>
      </div>

    </div>

  </div>
  <script>
/* ============================
      –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ò–ì–†–û–ö
============================ */

let tg = window.Telegram.WebApp;
tg.expand();

let userId = tg.initDataUnsafe?.user?.id || Math.floor(Math.random()*999999999);
let userName = tg.initDataUnsafe?.user?.username || "player";

let eggs = 0;
let chickens = 0;
let ton = 0;

let eggsPerHour = 0;
let eggTimer = 86;
let eggProgress = 0;

let incubatorActive = false;
let incubatorTime = 0;
let incubatorMax = 60;

let speedLevel = 1;
let profitLevel = 1;

let xp = 0;
let farmLevel = 1;

/* ============================
      –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
============================ */

function notify(text) {
  const box = document.createElement("div");
  box.className = "notify";
  box.innerText = text;
  document.getElementById("notifyContainer").appendChild(box);

  setTimeout(() => box.remove(), 3000);
}

/* ============================
      –°–û–•–†–ê–ù–ï–ù–ò–ï / –ó–ê–ì–†–£–ó–ö–ê
============================ */

function saveGame() {
  localStorage.setItem("eggs", eggs);
  localStorage.setItem("chickens", chickens);
  localStorage.setItem("ton", ton);
  localStorage.setItem("speedLevel", speedLevel);
  localStorage.setItem("profitLevel", profitLevel);
  localStorage.setItem("xp", xp);
  localStorage.setItem("farmLevel", farmLevel);
}

function loadGame() {
  eggs = Number(localStorage.getItem("eggs")) || 0;
  chickens = Number(localStorage.getItem("chickens")) || 0;
  ton = Number(localStorage.getItem("ton")) || 0;
  speedLevel = Number(localStorage.getItem("speedLevel")) || 1;
  profitLevel = Number(localStorage.getItem("profitLevel")) || 1;
  xp = Number(localStorage.getItem("xp")) || 0;
  farmLevel = Number(localStorage.getItem("farmLevel")) || 1;

  updateUI();
}

loadGame();

/* ============================
      –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
============================ */

function updateUI() {
  document.getElementById("eggs").innerText = eggs;
  document.getElementById("chickens").innerText = chickens;
  document.getElementById("ton").innerText = ton.toFixed(2);
  document.getElementById("eggsPerHour").innerText = (chickens * speedLevel).toFixed(0);
  document.getElementById("speedLevelText").innerText = speedLevel;
  document.getElementById("profitLevelText").innerText = profitLevel;
  document.getElementById("xp").innerText = xp;
  document.getElementById("farmLevel").innerText = farmLevel;

  let farmNames = ["–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è —Ñ–µ—Ä–º–∞", "–ö–∞–º–µ–Ω–Ω–∞—è —Ñ–µ—Ä–º–∞", "–ñ–µ–ª–µ–∑–Ω–∞—è —Ñ–µ—Ä–º–∞", "–ó–æ–ª–æ—Ç–∞—è —Ñ–µ—Ä–º–∞"];
  document.getElementById("farmName").innerText = farmNames[farmLevel - 1] || "–§–µ—Ä–º–∞";
}

/* ============================
      –ü–†–û–ò–ó–í–û–î–°–¢–í–û –Ø–ò–¶
============================ */

setInterval(() => {
  eggTimer -= 1;
  eggProgress += 1;

  if (eggTimer <= 0) {
    eggs += chickens * speedLevel;
    eggTimer = 86;
    eggProgress = 0;
    updateUI();
  }

  document.getElementById("timer").innerText = eggTimer;
  document.getElementById("progressFill").style.width = (eggProgress / 86 * 100) + "%";

}, 1000);

/* ============================
      –ò–ù–ö–£–ë–ê–¢–û–†
============================ */

function startIncubator() {
  if (eggs < 100) {
    notify("‚ùå –ù—É–∂–Ω–æ 100 —è–∏—Ü");
    return;
  }
  if (incubatorActive) {
    notify("‚è≥ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
    return;
  }

  eggs -= 100;
  incubatorActive = true;
  incubatorTime = 0;
  notify("üß™ –ò–Ω–∫—É–±–∞—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω!");
  updateUI();
}

setInterval(() => {
  if (!incubatorActive) return;

  incubatorTime++;
  document.getElementById("incStatus").innerText = incubatorTime + "/" + incubatorMax;
  document.getElementById("incubatorFill").style.width = (incubatorTime / incubatorMax * 100) + "%";

  if (incubatorTime >= incubatorMax) {
    incubatorActive = false;
    chickens += 95;
    xp += 20;
    notify("üê£ +95 –∫—É—Ä!");
    updateUI();
  }
}, 1000);

/* ============================
      –ü–û–ö–£–ü–ö–ê / –ü–†–û–î–ê–ñ–ê
============================ */

function buyChickens() {
  if (ton < 1) {
    notify("‚ùå –ù—É–∂–Ω–æ 1 TON");
    return;
  }
  ton -= 1;
  chickens += 3000;
  xp += 5;
  notify("üêî +3000 –∫—É—Ä");
  updateUI();
}

function sellEggs() {
  if (eggs < 100) {
    notify("‚ùå –ù—É–∂–Ω–æ 100 —è–∏—Ü");
    return;
  }
  eggs -= 100;
  let gain = 0.1 * profitLevel;
  ton += gain;
  xp += 2;
  notify("üí∞ +" + gain.toFixed(2) + " TON");
  updateUI();
}

/* ============================
      –£–õ–£–ß–®–ï–ù–ò–Ø
============================ */

function upgradeSpeed() {
  if (ton < 5) {
    notify("‚ùå –ù—É–∂–Ω–æ 5 TON");
    return;
  }
  ton -= 5;
  speedLevel++;
  notify("‚ö° –°–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞!");
  updateUI();
}

function upgradeProfit() {
  if (ton < 5) {
    notify("‚ùå –ù—É–∂–Ω–æ 5 TON");
    return;
  }
  ton -= 5;
  profitLevel++;
  notify("üí∞ –ü—Ä–∏–±—ã–ª—å —É–≤–µ–ª–∏—á–µ–Ω–∞!");
  updateUI();
}

/* ============================
      –î–û–°–¢–ò–ñ–ï–ù–ò–Ø
============================ */

setInterval(() => {
  if (eggs >= 1000) document.getElementById("ach1").style.background = "#f1c40f";
  if (chickens >= 3000) document.getElementById("ach2").style.background = "#f1c40f";
  if (farmLevel >= 3) document.getElementById("ach3").style.background = "#f1c40f";
}, 2000);

/* ============================
      –í–ö–õ–ê–î–ö–ò
============================ */

function switchTab(tab) {
  document.getElementById("tabUpgrades").classList.remove("active");
  document.getElementById("tabAchievements").classList.remove("active");
  document.getElementById("tabAuction").classList.remove("active");

  document.getElementById("tabContentUpgrades").style.display = "none";
  document.getElementById("tabContentAchievements").style.display = "none";
  document.getElementById("tabContentAuction").style.display = "none";

  if (tab === "upgrades") {
    document.getElementById("tabUpgrades").classList.add("active");
    document.getElementById("tabContentUpgrades").style.display = "block";
  }
  if (tab === "achievements") {
    document.getElementById("tabAchievements").classList.add("active");
    document.getElementById("tabContentAchievements").style.display = "block";
  }
  if (tab === "auction") {
    document.getElementById("tabAuction").classList.add("active");
    document.getElementById("tabContentAuction").style.display = "block";
  }
}

/* ============================
      –†–ï–§–ï–†–ê–õ–ö–ê
============================ */

function copyRef() {
  let link = "https://t.me/" + tg.initDataUnsafe?.user?.username + "?start=" + userId;
  navigator.clipboard.writeText(link);
  document.getElementById("refLinkText").innerText = link;
  notify("üîó –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
}
</script>
<script>
/* ============================
      –ê–£–ö–¶–ò–û–ù ‚Äî –ß–ê–°–¢–¨ A
   –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
============================ */

let auctions = {};

function copyRef() {
  let link = "https://t.me/feema_ton_usdt_bot?start=" + userId;
  navigator.clipboard.writeText(link);
  document.getElementById("refLinkText").innerText = link;
  notify("üîó –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
}
function renderAuctionList() {
  let box = document.getElementById("auctionList");
  box.innerHTML = "";

  let keys = Object.keys(auctions);
  if (keys.length === 0) {
    box.innerHTML = "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤";
    return;
  }

  keys.forEach(id => {
    let a = auctions[id];
    let sellerTag = String(a.sellerId).slice(-4);

    let timeLeft = Math.max(0, a.endTime - Date.now());
    let sec = Math.floor(timeLeft / 1000);

    let buyerText = a.currentBidder
      ? "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å: #" + String(a.currentBidder).slice(-4)
      : "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å: ‚Äî";

    let html = `
      <div style="border:3px solid #000;background:#fff;padding:6px;margin-bottom:8px;">
        <div style="font-size:10px;">–ü—Ä–æ–¥–∞–≤–µ—Ü #${sellerTag}</div>
        <div>ü•ö ${a.eggs} —è–∏—Ü</div>
        <div>${a.currentBidder ? "–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞" : "–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞"}: ${a.currentBid} TON</div>
        <div>${buyerText}</div>
        <div>‚è≥ ${sec} —Å–µ–∫</div>
        <button class="pixel-btn" onclick="openBidWindow('${id}')">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
      </div>
    `;

    box.innerHTML += html;
  });
}

loadAuctions();
</script>
<script>
/* ============================
      –ê–£–ö–¶–ò–û–ù ‚Äî –ß–ê–°–¢–¨ B
   –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ—Ç–∞
============================ */

function openCreateAuction() {
  document.getElementById("createAuctionWindow").style.display = "block";
}

function closeCreateAuction() {
  document.getElementById("createAuctionWindow").style.display = "none";
}

function createAuction() {
  let eggsCount = Number(document.getElementById("auctionEggs").value);
  let price = Number(document.getElementById("auctionPrice").value);

  if (eggsCount < 100) {
    notify("‚ùå –ú–∏–Ω–∏–º—É–º 100 —è–∏—Ü");
    return;
  }
  if (eggs < eggsCount) {
    notify("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —è–∏—Ü");
    return;
  }
  if (price <= 0) {
    notify("‚ùå –¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0");
    return;
  }
  if (ton < price * 0.05) {
    notify("‚ùå –ö–æ–º–∏—Å—Å–∏—è 5% TON");
    return;
  }

  eggs -= eggsCount;
  ton -= price * 0.05;

  let id = db.ref("auctions").push().key;

  db.ref("auctions/" + id).set({
    sellerId: userId,
    eggs: eggsCount,
    minPrice: price,
    currentBid: price,
    currentBidder: null,
    endTime: Date.now() + 120000, // 2 –º–∏–Ω—É—Ç—ã
    bids: {}
  });

  notify("üì¶ –õ–æ—Ç —Å–æ–∑–¥–∞–Ω!");
  closeCreateAuction();
  updateUI();
}
</script>
<script>
/* ============================
      –ê–£–ö–¶–ò–û–ù ‚Äî –ß–ê–°–¢–¨ C
   –°—Ç–∞–≤–∫–∏, —Ç–∞–π–º–µ—Ä, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
============================ */

function openBidWindow(id) {
  let a = auctions[id];
  if (!a) return;

  let bid = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É TON (–±–æ–ª—å—à–µ " + a.currentBid + "):");
  if (!bid) return;

  bid = Number(bid);
  if (bid <= a.currentBid) {
    notify("‚ùå –°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—à–µ");
    return;
  }

  placeBid(id, bid);
}

function placeBid(id, bid) {
  let a = auctions[id];
  if (!a) return;

  if (a.sellerId === userId) {
    notify("‚ùå –ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Å–≤–æ–π –ª–æ—Ç");
    return;
  }

  let fee = bid * 0.05;
  if (ton < bid + fee) {
    notify("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON");
    return;
  }

  ton -= (bid + fee);

  if (a.currentBidder && a.currentBidder !== userId) {
    if (a.bids && a.bids[a.currentBidder]) {
      ton += a.bids[a.currentBidder];
    }
  }

  db.ref("auctions/" + id).update({
    currentBid: bid,
    currentBidder: userId
  });

  db.ref("auctions/" + id + "/bids/" + userId).set(bid);

  notify("‚úÖ –°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!");
  updateUI();
}

setInterval(() => {
  let keys = Object.keys(auctions);
  keys.forEach(id => {
    let a = auctions[id];
    if (!a) return;

    if (Date.now() >= a.endTime) {
      finishAuction(id, a);
    }
  });
}, 1000);

function finishAuction(id, a) {
  if (!a) return;

  if (a.currentBidder) {
    if (a.currentBidder === userId) {
      chickens += a.eggs;
      notify("üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –∞—É–∫—Ü–∏–æ–Ω! +" + a.eggs + " —è–∏—Ü");
    }

    if (a.sellerId === userId) {
      let gain = a.currentBid * 0.95;
      ton += gain;
      notify("üí∞ –õ–æ—Ç –ø—Ä–æ–¥–∞–Ω! +" + gain.toFixed(2) + " TON");
    }
  } else {
    if (a.sellerId === userId) {
      eggs += a.eggs;
      notify("‚Ü© –õ–æ—Ç –Ω–µ –ø—Ä–æ–¥–∞–Ω, —è–π—Ü–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã");
    }
  }

  db.ref("auctions/" + id).remove();
  updateUI();
}
</script>