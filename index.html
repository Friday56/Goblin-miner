<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>TON Farm</title>

  <link rel="stylesheet" href="style.css">

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7VX72GI4L9RpVB212torJKhTdOEELDGk",
      authDomain: "ton-bon.firebaseapp.com",
      databaseURL: "https://ton-bon-default-rtdb.firebaseio.com",
      projectId: "ton-bon",
      storageBucket: "ton-bon.firebasestorage.app",
      messagingSenderId: "747409619156",
      appId: "1:747409619156:web:0ec4e018f8f674b7b02341",
      measurementId: "G-HY4KES5K2X"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    window.db = db;
  </script>
</head>
<body>

  <div id="appRoot" class="app-root">
    <header id="globalBanner" class="banner">‚è≥ –î–æ –Ω–∞—á–∞–ª–∞ –º–∏–Ω—Ç–∞: <span id="globalTimer">00:00:00</span></header>

    <main id="mainArea" class="main-area">
      <!-- FARM -->
      <section id="screen_farm" class="screen active">
        <h1 class="title">üêî PIXEL TON FARM</h1>

        <div class="stats-row">
          <div class="stat">–ö—É—Ä—ã<br><span id="chickens">0</span></div>
          <div class="stat">–Ø–π—Ü–∞<br><span id="eggs">0</span></div>
          <div class="stat">TON<br><span id="ton">0</span></div>
        </div>

        <div class="controls">
          <button class="pixel-btn" id="buyChickensLimited" onclick="buyChickensLimited()">–ö—É–ø–∏—Ç—å –∫—É—Ä (1 TON)</button>
          <div class="small">–£–∂–µ –∫—É–ø–∏–ª–∏: <span id="limitedBought">0</span>/100</div>

          <div class="progress-block">
            <div class="label">–¢–∞–π–º–µ—Ä —è–∏—Ü</div>
            <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
            <div class="label">–Ø–∏—Ü –≤ —á–∞—Å: <span id="eggsPerHour">0</span></div>
          </div>

          <button class="pixel-btn" onclick="startIncubator()">üß™ –ò–Ω–∫—É–±–∞—Ç–æ—Ä</button>
          <div class="small">–ò–Ω–∫—É–±–∞—Ç–æ—Ä: <span id="incStatus">–û–∂–∏–¥–∞–Ω–∏–µ</span></div>

          <div class="upgrades">
            <button class="pixel-btn small-btn" onclick="upgradeSpeed()">‚ö° –°–∫–æ—Ä–æ—Å—Ç—å (5 TON)</button>
            <button class="pixel-btn small-btn" onclick="upgradeProfit()">üí∞ –ü—Ä–∏–±—ã–ª—å (5 TON)</button>
          </div>

          <div class="small">–£—Ä–æ–≤–µ–Ω—å: <span id="farmLevel">1</span>  XP: <span id="xp">0</span></div>
        </div>
      </section>

      <!-- MARKET -->
      <section id="screen_market" class="screen">
        <h2 class="title">üõí –†—ã–Ω–æ–∫</h2>
        <div class="controls">
          <button class="pixel-btn" onclick="openMarketCreate()">–í—ã—Å—Ç–∞–≤–∏—Ç—å —è–π—Ü–∞</button>
          <div id="marketList" class="list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
      </section>

      <!-- AUCTION -->
      <section id="screen_auction" class="screen">
        <h2 class="title">üì¶ –ê—É–∫—Ü–∏–æ–Ω</h2>
        <div class="controls">
          <button class="pixel-btn" onclick="openCreateAuction()">–°–æ–∑–¥–∞—Ç—å –∞—É–∫—Ü–∏–æ–Ω</button>
          <div id="auctionList" class="list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
      </section>

      <!-- REF -->
      <section id="screen_ref" class="screen">
        <h2 class="title">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</h2>
        <div class="controls">
          <button class="pixel-btn" onclick="copyRefLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
          <button class="pixel-btn" onclick="showMyReferrals()">–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</button>
        </div>
      </section>

      <!-- WALLET -->
      <section id="screen_wallet" class="screen">
        <h2 class="title">üíº –ö–æ—à–µ–ª—ë–∫</h2>
        <div class="stats-row">
          <div class="stat">TON<br><span id="walletTon">0</span></div>
          <div class="stat">–Ø–∏—Ü<br><span id="walletEggs">0</span></div>
          <div class="stat">–ö—É—Ä<br><span id="walletChickens">0</span></div>
        </div>
        <div class="controls">
          <button class="pixel-btn" onclick="openDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</button>
          <button class="pixel-btn" onclick="openWithdraw()">–í—ã–≤–µ—Å—Ç–∏ TON</button>
        </div>
      </section>
    </main>

    <div id="notifyContainer" class="notify-container"></div>

    <!-- Bottom tabs -->
    <nav id="bottomTabs" role="tablist" aria-label="Navigation">
      <div class="tab active" role="tab" onclick="openTab('farm', event)"><div class="icon">üêî</div><div class="label">–§–µ—Ä–º–∞</div></div>
      <div class="tab" role="tab" onclick="openTab('market', event)"><div class="icon">üõí</div><div class="label">–†—ã–Ω–æ–∫</div></div>
      <div class="tab" role="tab" onclick="openTab('auction', event)"><div class="icon">üì¶</div><div class="label">–ê—É–∫—Ü–∏–æ–Ω</div></div>
      <div class="tab" role="tab" onclick="openTab('ref', event)"><div class="icon">üë•</div><div class="label">–†–µ—Ñ</div></div>
      <div class="tab" role="tab" onclick="openTab('wallet', event)"><div class="icon">üíº</div><div class="label">–ö–æ—à–µ–ª—ë–∫</div></div>
    </nav>
  </div>

  <!-- Modal windows (hidden by default) -->
  <div id="createMarketWindow" class="modal hidden">
    <div class="modal-inner">
      <h3>–ü—Ä–æ–¥–∞–∂–∞ —è–∏—Ü</h3>
      <input id="marketEggs" type="number" placeholder="–Ø–∏—Ü (–º–∏–Ω. 100)">
      <input id="marketPrice" type="number" placeholder="–¶–µ–Ω–∞ TON">
      <div class="modal-actions">
        <button class="pixel-btn" onclick="createMarketLot()">–í—ã—Å—Ç–∞–≤–∏—Ç—å</button>
        <button class="pixel-btn" onclick="closeMarketCreate()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <div id="createAuctionWindow" class="modal hidden">
    <div class="modal-inner">
      <h3>–ê—É–∫—Ü–∏–æ–Ω</h3>
      <input id="auctionEggs" type="number" placeholder="–Ø–∏—Ü (–º–∏–Ω. 100)">
      <input id="auctionPrice" type="number" placeholder="–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ TON">
      <div class="modal-actions">
        <button class="pixel-btn" onclick="createAuction()">–°–æ–∑–¥–∞—Ç—å</button>
        <button class="pixel-btn" onclick="closeCreateAuction()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- Scripts: correct order -->
  <script src="farm.js"></script>
  <script src="bonus.js"></script>
  <script src="ref.js"></script>
  <script src="market.js"></script>
  <script src="auction.js"></script>
  <script src="wallet.js"></script>

  <!-- UI helpers -->
  <script>
    function setActiveTabElement(el) {
      document.querySelectorAll("#bottomTabs .tab").forEach(t => t.classList.remove("active"));
      if (!el) return;
      const tab = el.closest ? el.closest('.tab') : el;
      if (tab) tab.classList.add("active");
    }

    function openTab(tab, ev) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      const screen = document.getElementById("screen_" + tab);
      if (screen) screen.classList.add("active");
      setActiveTabElement(ev.currentTarget || ev.target);
      if (tab === "wallet") {
        const wt = document.getElementById("walletTon");
        const we = document.getElementById("walletEggs");
        const wc = document.getElementById("walletChickens");
        if (wt) wt.innerText = (typeof window.ton === "number") ? window.ton.toFixed(2) : "0.00";
        if (we) we.innerText = window.eggs || 0;
        if (wc) wc.innerText = window.chickens || 0;
      }
    }

    // Simple modal helpers
    function openMarketCreate(){ document.getElementById('createMarketWindow').classList.remove('hidden'); }
    function closeMarketCreate(){ document.getElementById('createMarketWindow').classList.add('hidden'); }
    function openCreateAuction(){ document.getElementById('createAuctionWindow').classList.remove('hidden'); }
    function closeCreateAuction(){ document.getElementById('createAuctionWindow').classList.add('hidden'); }
  </script>
</body>
</html>