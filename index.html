<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Notcoin‑style Clicker PRO</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: radial-gradient(circle at top, #222 0, #050505 55%, #000 100%);
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 20px;
      letter-spacing: 1px;
    }
    .top-bar {
      margin-top: 5px;
      font-size: 13px;
      opacity: 0.8;
    }
    .stats {
      margin: 10px 0 10px;
      text-align: center;
    }
    .stats span {
      display: inline-block;
      margin: 0 8px;
      font-size: 16px;
    }
    .level-bar {
      width: 90%;
      max-width: 500px;
      margin: 5px auto 15px;
    }
    .level-label {
      font-size: 13px;
      margin-bottom: 4px;
      opacity: 0.8;
    }
    .level-progress {
      width: 100%;
      height: 10px;
      background: #222;
      border-radius: 999px;
      overflow: hidden;
    }
    .level-progress-inner {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #42a5f5, #ab47bc);
      transition: width 0.2s ease-out;
    }

    .main-area {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .coin-wrapper {
      margin-top: 10px;
      width: 220px;
      height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .coin-btn {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: none;
      background: none;
      padding: 0;
      cursor: pointer;
      position: relative;
      transition: transform 0.05s ease-out;
    }
    .coin-btn:active {
      transform: scale(0.93);
    }
    .coin-btn img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
      object-fit: cover;
    }

    .floating-text {
      position: absolute;
      color: #ffd54f;
      font-weight: 700;
      pointer-events: none;
      animation: floatUp 0.7s ease-out forwards;
      text-shadow: 0 0 6px rgba(0,0,0,0.8);
    }
    .floating-text.crit {
      color: #ff5252;
      text-shadow: 0 0 10px rgba(255,82,82,0.9);
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-40px); }
    }

    .panels {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
      width: 100%;
      max-width: 1000px;
      padding: 0 10px 20px;
    }
    .panel {
      flex: 1 1 300px;
      background: rgba(15, 15, 15, 0.9);
      border-radius: 12px;
      padding: 12px;
      border: 1px solid #333;
      min-width: 280px;
      max-width: 480px;
    }
    .section-title {
      font-size: 15px;
      margin-bottom: 8px;
      opacity: 0.9;
    }
    .item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #222;
      font-size: 13px;
    }
    .item-row:last-child {
      border-bottom: none;
    }
    .item-info {
      max-width: 70%;
    }
    .item-info div:first-child {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .item-info div:last-child {
      opacity: 0.8;
    }

    .btn {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }
    .btn-buy {
      background: linear-gradient(135deg, #ffd54f, #ffb300);
      color: #000;
    }
    .btn-buy:disabled {
      background: #555;
      color: #999;
      cursor: default;
    }
    .btn-skin {
      background: #333;
      color: #eee;
    }
    .btn-skin.active {
      background: linear-gradient(135deg, #42a5f5, #1e88e5);
      color: #fff;
    }
    .btn-small {
      padding: 4px 8px;
      font-size: 11px;
    }

    .quest-done {
      color: #81c784;
      font-weight: 600;
    }

    .leaderboard-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 3px 0;
      border-bottom: 1px solid #222;
    }
    .leaderboard-row:last-child {
      border-bottom: none;
    }

    .footer {
      margin-top: auto;
      padding: 10px;
      font-size: 11px;
      opacity: 0.6;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Notcoin‑style Clicker PRO</h1>
  <div class="top-bar">
    Локальный прогресс, квесты, бусты, уровни, “топ”.
  </div>

  <div class="stats">
    <span>Монеты: <strong id="coins">0</strong></span>
    <span>За клик: <strong id="perClick">1</strong></span>
    <span>Авто/сек: <strong id="perSec">0</strong></span>
  </div>

  <div class="level-bar">
    <div class="level-label">
      Уровень: <span id="level">1</span> • Опыт: <span id="xp">0</span>/<span id="xpToNext">50</span>
    </div>
    <div class="level-progress">
      <div class="level-progress-inner" id="levelProgressInner"></div>
    </div>
  </div>

  <div class="main-area">
    <div class="coin-wrapper" id="coinWrapper">
      <button class="coin-btn" id="coinBtn">
        <img id="coinImage" src="img/coin1.png" alt="coin">
      </button>
    </div>
  </div>

  <div class="panels">
    <!-- Апгрейды -->
    <div class="panel">
      <div class="section-title">Апгрейды</div>

      <div class="item-row">
        <div class="item-info">
          <div>+1 за клик</div>
          <div>Цена: <span id="clickUpgradeCost">10</span></div>
        </div>
        <button class="btn btn-buy" id="buyClickUpgrade">Купить</button>
      </div>

      <div class="item-row">
        <div class="item-info">
          <div>+1 в секунду</div>
          <div>Цена: <span id="autoUpgradeCost">25</span></div>
        </div>
        <button class="btn btn-buy" id="buyAutoUpgrade">Купить</button>
      </div>
    </div>

    <!-- Бусты -->
    <div class="panel">
      <div class="section-title">Бусты</div>

      <div class="item-row">
        <div class="item-info">
          <div>x2 за клик (30 сек)</div>
          <div>Цена: <span id="boostClickCost">100</span></div>
        </div>
        <button class="btn btn-buy" id="buyBoostClick">Активировать</button>
      </div>

      <div class="item-row">
        <div class="item-info">
          <div>x2 авто‑доход (30 сек)</div>
          <div>Цена: <span id="boostAutoCost">150</span></div>
        </div>
        <button class="btn btn-buy" id="buyBoostAuto">Активировать</button>
      </div>

      <div class="item-row">
        <div class="item-info">
          <div>Шанс крита: <span id="critChanceLabel">10%</span></div>
          <div>Крит x3, можно бафать шанс</div>
        </div>
      </div>
    </div>

    <!-- Скины -->
    <div class="panel">
      <div class="section-title">Скины монеты (7 картинок)</div>

      <div class="item-row">
        <div class="item-info"><div>Скин 1</div></div>
        <button class="btn btn-skin active" data-skin="1">Выбрать</button>
      </div>
      <div class="item-row">
        <div class="item-info"><div>Скин 2</div></div>
        <button class="btn btn-skin" data-skin="2">Выбрать</button>
      </div>
      <div class="item-row">
        <div class="item-info"><div>Скин 3</div></div>
        <button class="btn btn-skin" data-skin="3">Выбрать</button>
      </div>
      <div class="item-row">
        <div class="item-info"><div>Скин 4</div></div>
        <button class="btn btn-skin" data-skin="4">Выбрать</button>
      </div>
      <div class="item-row">
        <div class="item-info"><div>Скин 5</div></div>
        <button class="btn btn-skin" data-skin="5">Выбрать</button>
      </div>
      <div class="item-row">
        <div class="item-info"><div>Скин 6</div></div>
        <button class="btn btn-skin" data-skin="6">Выбрать</button>
      </div>
      <div class="item-row">
        <div class="item-info"><div>Скин 7</div></div>
        <button class="btn btn-skin" data-skin="7">Выбрать</button>
      </div>
    </div>

    <!-- Квесты -->
    <div class="panel">
      <div class="section-title">Квесты</div>
      <div id="questsContainer"></div>
    </div>

    <!-- Локальный “топ” -->
    <div class="panel">
      <div class="section-title">Локальный топ (по общему заработку)</div>
      <div style="margin-bottom: 6px; font-size: 12px; opacity: 0.8;">
        Ник: <input id="nicknameInput" style="width: 120px; font-size: 11px; padding: 2px 4px;">
        <button class="btn btn-small" id="saveNicknameBtn">Сохранить</button>
      </div>
      <div id="leaderboard"></div>
      <button class="btn btn-small" id="pushToLeaderboardBtn" style="margin-top: 6px;">
        Обновить запись в топе
      </button>
    </div>
  </div>

  <div class="footer">
    Всё хранится в localStorage. Можно ломать, менять, экспериментировать.
  </div>

  <script>
    // --- БАЗОВЫЕ ПЕРЕМЕННЫЕ ---
    let coins = 0;
    let perClick = 1;
    let perSec = 0;

    let clickUpgradeCost = 10;
    let autoUpgradeCost = 25;

    let boostClickCost = 100;
    let boostAutoCost = 150;

    let clickBoostActive = false;
    let autoBoostActive = false;
    let clickBoostEndTime = 0;
    let autoBoostEndTime = 0;

    let critChance = 0.10; // 10%
    const critMultiplier = 3;

    let level = 1;
    let xp = 0;
    let xpToNext = 50;

    let totalEarned = 0; // для “топа”
    let nickname = 'Player';

    const quests = [
      { id: 1, text: 'Накликай 100 монет', type: 'coins', target: 100, reward: 50, done: false },
      { id: 2, text: 'Купи 3 апгрейда клика', type: 'clickUpgrades', target: 3, reward: 100, done: false },
      { id: 3, text: 'Купи 2 авто‑апгрейда', type: 'autoUpgrades', target: 2, reward: 150, done: false },
      { id: 4, text: 'Заработай 1000 монет всего', type: 'totalEarned', target: 1000, reward: 200, done: false }
    ];
    let clickUpgradesBought = 0;
    let autoUpgradesBought = 0;

    // --- DOM ---
    const coinsEl = document.getElementById('coins');
    const perClickEl = document.getElementById('perClick');
    const perSecEl = document.getElementById('perSec');

    const clickUpgradeCostEl = document.getElementById('clickUpgradeCost');
    const autoUpgradeCostEl = document.getElementById('autoUpgradeCost');

    const coinBtn = document.getElementById('coinBtn');
    const coinWrapper = document.getElementById('coinWrapper');
    const coinImage = document.getElementById('coinImage');

    const buyClickUpgradeBtn = document.getElementById('buyClickUpgrade');
    const buyAutoUpgradeBtn = document.getElementById('buyAutoUpgrade');

    const boostClickCostEl = document.getElementById('boostClickCost');
    const boostAutoCostEl = document.getElementById('boostAutoCost');
    const buyBoostClickBtn = document.getElementById('buyBoostClick');
    const buyBoostAutoBtn = document.getElementById('buyBoostAuto');
    const critChanceLabel = document.getElementById('critChanceLabel');

    const skinButtons = document.querySelectorAll('.btn-skin');

    const levelEl = document.getElementById('level');
    const xpEl = document.getElementById('xp');
    const xpToNextEl = document.getElementById('xpToNext');
    const levelProgressInner = document.getElementById('levelProgressInner');

    const questsContainer = document.getElementById('questsContainer');

    const nicknameInput = document.getElementById('nicknameInput');
    const saveNicknameBtn = document.getElementById('saveNicknameBtn');
    const leaderboardEl = document.getElementById('leaderboard');
    const pushToLeaderboardBtn = document.getElementById('pushToLeaderboardBtn');

    // --- LOCALSTORAGE ---
    const STORAGE_KEY = 'notcoin_clicker_pro';

    function saveState() {
      const state = {
        coins,
        perClick,
        perSec,
        clickUpgradeCost,
        autoUpgradeCost,
        boostClickCost,
        boostAutoCost,
        clickBoostActive,
        autoBoostActive,
        clickBoostEndTime,
        autoBoostEndTime,
        critChance,
        level,
        xp,
        xpToNext,
        totalEarned,
        nickname,
        quests,
        clickUpgradesBought,
        autoUpgradesBought,
        currentSkin: coinImage.src
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      try {
        const state = JSON.parse(raw);
        coins = state.coins ?? coins;
        perClick = state.perClick ?? perClick;
        perSec = state.perSec ?? perSec;
        clickUpgradeCost = state.clickUpgradeCost ?? clickUpgradeCost;
        autoUpgradeCost = state.autoUpgradeCost ?? autoUpgradeCost;
        boostClickCost = state.boostClickCost ?? boostClickCost;
        boostAutoCost = state.boostAutoCost ?? boostAutoCost;
        clickBoostActive = state.clickBoostActive ?? false;
        autoBoostActive = state.autoBoostActive ?? false;
        clickBoostEndTime = state.clickBoostEndTime ?? 0;
        autoBoostEndTime = state.autoBoostEndTime ?? 0;
        critChance = state.critChance ?? critChance;
        level = state.level ?? level;
        xp = state.xp ?? xp;
        xpToNext = state.xpToNext ?? xpToNext;
        totalEarned = state.totalEarned ?? totalEarned;
        nickname = state.nickname ?? nickname;
        if (state.quests) {
          state.quests.forEach(savedQ => {
            const q = quests.find(q => q.id === savedQ.id);
            if (q) {
              q.done = savedQ.done;
            }
          });
        }
        clickUpgradesBought = state.clickUpgradesBought ?? clickUpgradesBought;
        autoUpgradesBought = state.autoUpgradesBought ?? autoUpgradesBought;
        if (state.currentSkin) {
          coinImage.src = state.currentSkin;
          const match = state.currentSkin.match(/coin(\d+)\./);
          if (match) {
            const skinId = match[1];
            skinButtons.forEach(b => {
              b.classList.toggle('active', b.getAttribute('data-skin') === skinId);
            });
          }
        }
      } catch (e) {
        console.error('Failed to load state', e);
      }
    }

    // --- ЛИДЕРБОРД ---
    const LB_KEY = 'notcoin_clicker_pro_leaderboard';

    function loadLeaderboard() {
      const raw = localStorage.getItem(LB_KEY);
      if (!raw) return [];
      try {
        return JSON.parse(raw);
      } catch {
        return [];
      }
    }

    function saveLeaderboard(lb) {
      localStorage.setItem(LB_KEY, JSON.stringify(lb));
    }

    function renderLeaderboard() {
      const lb = loadLeaderboard().sort((a, b) => b.totalEarned - a.totalEarned).slice(0, 10);
      leaderboardEl.innerHTML = '';
      if (lb.length === 0) {
        leaderboardEl.innerHTML = '<div style="font-size:12px; opacity:0.7;">Пока пусто. Обнови запись, когда наберёшь монеты.</div>';
        return;
      }
      lb.forEach((entry, index) => {
        const row = document.createElement('div');
        row.className = 'leaderboard-row';
        row.innerHTML = `
          <div>#${index + 1} ${entry.nickname}</div>
          <div>${entry.totalEarned}</div>
        `;
        leaderboardEl.appendChild(row);
      });
    }

    function pushToLeaderboard() {
      const lb = loadLeaderboard();
      const existing = lb.find(e => e.nickname === nickname);
      if (existing) {
        if (totalEarned > existing.totalEarned) {
          existing.totalEarned = totalEarned;
        }
      } else {
        lb.push({ nickname, totalEarned });
      }
      saveLeaderboard(lb);
      renderLeaderboard();
    }

    // --- КВЕСТЫ ---
    function renderQuests() {
      questsContainer.innerHTML = '';
      quests.forEach(q => {
        const row = document.createElement('div');
        row.className = 'item-row';
        const status = q.done ? `<span class="quest-done">Выполнено (+${q.reward})</span>` : '';
        row.innerHTML = `
          <div class="item-info">
            <div>${q.text}</div>
            <div>Цель: ${q.target} • Награда: ${q.reward}</div>
          </div>
          <div>${status}</div>
        `;
        questsContainer.appendChild(row);
      });
    }

    function checkQuests() {
      quests.forEach(q => {
        if (q.done) return;
        let progress = 0;
        if (q.type === 'coins') progress = coins;
        if (q.type === 'clickUpgrades') progress = clickUpgradesBought;
        if (q.type === 'autoUpgrades') progress = autoUpgradesBought;
        if (q.type === 'totalEarned') progress = totalEarned;

        if (progress >= q.target) {
          q.done = true;
          coins += q.reward;
          totalEarned += q.reward;
          addXP(q.reward * 0.5);
        }
      });
      renderQuests();
    }

    // --- УРОВНИ ---
    function addXP(amount) {
      xp += amount;
      while (xp >= xpToNext) {
        xp -= xpToNext;
        level++;
        xpToNext = Math.floor(xpToNext * 1.4);
        critChance = Math.min(0.5, critChance + 0.02); // +2% за уровень, максимум 50%
      }
      updateLevelUI();
    }

    function updateLevelUI() {
      levelEl.textContent = level;
      xpEl.textContent = Math.floor(xp);
      xpToNextEl.textContent = xpToNext;
      const percent = Math.min(100, (xp / xpToNext) * 100);
      levelProgressInner.style.width = percent + '%';
      critChanceLabel.textContent = Math.round(critChance * 100) + '%';
    }

    // --- UI ОБНОВЛЕНИЕ ---
    function updateUI() {
      coinsEl.textContent = Math.floor(coins);
      perClickEl.textContent = perClick;
      perSecEl.textContent = perSec;

      clickUpgradeCostEl.textContent = clickUpgradeCost;
      autoUpgradeCostEl.textContent = autoUpgradeCost;

      boostClickCostEl.textContent = boostClickCost;
      boostAutoCostEl.textContent = boostAutoCost;

      buyClickUpgradeBtn.disabled = coins < clickUpgradeCost;
      buyAutoUpgradeBtn.disabled = coins < autoUpgradeCost;
      buyBoostClickBtn.disabled = coins < boostClickCost;
      buyBoostAutoBtn.disabled = coins < boostAutoCost;

      nicknameInput.value = nickname;
      updateLevelUI();
      saveState();
    }

    // --- АНИМАЦИЯ ЧИСЕЛ ---
    function spawnFloatingText(text, isCrit, x, y) {
      const span = document.createElement('span');
      span.className = 'floating-text' + (isCrit ? ' crit' : '');
      span.textContent = text;
      const rect = coinWrapper.getBoundingClientRect();
      const offsetX = x - rect.left;
      const offsetY = y - rect.top;
      span.style.left = offsetX + 'px';
      span.style.top = offsetY + 'px';
      coinWrapper.appendChild(span);
      setTimeout(() => span.remove(), 700);
    }

    // --- ЛОГИКА КЛИКА ---
    coinBtn.addEventListener('click', (e) => {
      const rect = coinWrapper.getBoundingClientRect();
      const clickX = e.clientX;
      const clickY = e.clientY;

      let gain = perClick;
      let isCrit = false;
      if (Math.random() < critChance) {
        gain *= critMultiplier;
        isCrit = true;
      }
      if (clickBoostActive) {
        gain *= 2;
      }

      coins += gain;
      totalEarned += gain;
      addXP(gain * 0.2);

      spawnFloatingText('+' + gain, isCrit, clickX, clickY);
      checkQuests();
      updateUI();
    });

    // --- АВТО‑ДОХОД ---
    setInterval(() => {
      let gain = perSec;
      if (autoBoostActive) gain *= 2;
      if (gain > 0) {
        coins += gain;
        totalEarned += gain;
        addXP(gain * 0.1);
        checkQuests();
        updateUI();
      }
    }, 1000);

    // --- ТАЙМЕРЫ БУСТОВ ---
    setInterval(() => {
      const now = Date.now();
      if (clickBoostActive && now >= clickBoostEndTime) {
        clickBoostActive = false;
      }
      if (autoBoostActive && now >= autoBoostEndTime) {
        autoBoostActive = false;
      }
      updateUI();
    }, 500);

    // --- ПОКУПКИ ---
    buyClickUpgradeBtn.addEventListener('click', () => {
      if (coins >= clickUpgradeCost) {
        coins -= clickUpgradeCost;
        perClick += 1;
        clickUpgradeCost = Math.floor(clickUpgradeCost * 1.6);
        clickUpgradesBought++;
        addXP(5);
        checkQuests();
        updateUI();
      }
    });

    buyAutoUpgradeBtn.addEventListener('click', () => {
      if (coins >= autoUpgradeCost) {
        coins -= autoUpgradeCost;
        perSec += 1;
        autoUpgradeCost = Math.floor(autoUpgradeCost * 1.8);
        autoUpgradesBought++;
        addXP(7);
        checkQuests();
        updateUI();
      }
    });

    buyBoostClickBtn.addEventListener('click', () => {
      if (coins >= boostClickCost) {
        coins -= boostClickCost;
        clickBoostActive = true;
        clickBoostEndTime = Date.now() + 30000; // 30 сек
        boostClickCost = Math.floor(boostClickCost * 1.7);
        addXP(10);
        updateUI();
      }
    });

    buyBoostAutoBtn.addEventListener('click', () => {
      if (coins >= boostAutoCost) {
        coins -= boostAutoCost;
        autoBoostActive = true;
        autoBoostEndTime = Date.now() + 30000;
        boostAutoCost = Math.floor(boostAutoCost * 1.7);
        addXP(12);
        updateUI();
      }
    });

    // --- СКИНЫ ---
    skinButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const skinId = btn.getAttribute('data-skin');
        coinImage.src = `img/coin${skinId}.png`;
        skinButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        saveState();
      });
    });

    // --- НИК И ТОП ---
    saveNicknameBtn.addEventListener('click', () => {
      nickname = nicknameInput.value.trim() || 'Player';
      updateUI();
    });

    pushToLeaderboardBtn.addEventListener('click', () => {
      pushToLeaderboard();
    });

    // --- ИНИЦИАЛИЗАЦИЯ ---
    loadState();
    renderQuests();
    renderLeaderboard();
    updateUI();
  </script>
</body>
</html>